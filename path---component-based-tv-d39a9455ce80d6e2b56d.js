webpackJsonp([81816190307459],{516:function(n,s){n.exports={data:{site:{siteMetadata:{title:"iOS Developer in search for meaning üßò‚Äç‚ôÇÔ∏è",author:"Serg Dort"}},markdownRemark:{id:"/Users/sergdort/Documents/Projects/Personal/blog/src/pages/component-based-tv/index.md absPath of file >>> MarkdownRemark",html:'<p>UITableView and UICollectionView are one of the most commonly used classes to display data. But they require to write a lot of boilerplate code in order to show it on screen. And it quite often end up being in a ViewController, making it larger then it should be.</p>\n<p>In order to prevent this, a common practice is to abstract <code class="language-text">UITableViewDataSource</code> into a separate class. The simplest use case could look something like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ArrayTableViewDataSource</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">:</span> <span class="token builtin">NSObject</span><span class="token punctuation">,</span> <span class="token builtin">UITableViewDataSource</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token operator">?</span>\n    <span class="token keyword">private</span> <span class="token keyword">let</span> cellFactory<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token builtin">UITableView</span><span class="token punctuation">,</span> <span class="token builtin">IndexPath</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">UITableViewCell</span>\n    <span class="token keyword">private</span> <span class="token keyword">var</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> cellFactory<span class="token punctuation">:</span> @escaping <span class="token punctuation">(</span><span class="token builtin">UITableView</span><span class="token punctuation">,</span> <span class="token builtin">IndexPath</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">UITableViewCell</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView <span class="token operator">=</span> tableView\n        <span class="token keyword">self</span><span class="token punctuation">.</span>cellFactory <span class="token operator">=</span> cellFactory\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">update</span><span class="token punctuation">(</span>with items<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items\n        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">reloadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> numberOfRowsInSection section<span class="token punctuation">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Int</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token builtin">count</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> cellForRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">UITableViewCell</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token function">cellFactory</span><span class="token punctuation">(</span>tableView<span class="token punctuation">,</span> indexPath<span class="token punctuation">,</span> items<span class="token punctuation">[</span>indexPath<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">MyViewController</span> <span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> dataSource <span class="token operator">=</span> <span class="token builtin">ArrayTableViewDataSource</span><span class="token operator">&lt;</span><span class="token builtin">Item</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>tableView<span class="token punctuation">,</span> indexPath<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">UITableViewCell</span> <span class="token keyword">in</span>\n        <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string">"Cell"</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span>\n\n        cell<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> item<span class="token punctuation">)</span>\n\n        <span class="token keyword">return</span> cell\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>It does looks nice, we abstracted <code class="language-text">UITableViewDataSource</code> boilerplate into a separate class that can be easily unit tested and reused across multiple places of our apps, what we need to do is just to provide a <code class="language-text">cellFactory</code> closure to dequeue a cell and setup it with a view model or a DTO.</p>\n<p>For a simple use case it works fine but what if we want to display items of different types in a different types of cells?</p>\n<p>Let‚Äôs say we have 3 different types of data that we want to display in a table view. A common solution for this problem would be to use <code class="language-text">Any</code> type or to use enums with associated values.</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token builtin">Type1</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> title<span class="token punctuation">:</span> <span class="token builtin">String</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CellType1</span><span class="token punctuation">:</span> <span class="token builtin">UITableViewCell</span> <span class="token punctuation">{</span>\n    <span class="token keyword">func</span> <span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token builtin">Type1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> <span class="token builtin">Type2</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> title<span class="token punctuation">:</span> <span class="token builtin">String</span>\n    <span class="token keyword">let</span> detail<span class="token punctuation">:</span> <span class="token builtin">String</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CellType2</span><span class="token punctuation">:</span> <span class="token builtin">UITableViewCell</span> <span class="token punctuation">{</span>\n    <span class="token keyword">func</span> <span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token builtin">Type2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> <span class="token builtin">Type3</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> title<span class="token punctuation">:</span> <span class="token builtin">String</span>\n    <span class="token keyword">let</span> detail<span class="token punctuation">:</span> <span class="token builtin">String</span>\n    <span class="token keyword">let</span> subtitle<span class="token punctuation">:</span> <span class="token builtin">String</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CellType3</span><span class="token punctuation">:</span> <span class="token builtin">UITableViewCell</span> <span class="token punctuation">{</span>\n    <span class="token keyword">func</span> <span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token builtin">Type3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<h2>Using Any type:</h2>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"> <span class="token keyword">class</span> <span class="token class-name">MyViewController</span> <span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">let</span> tableView <span class="token operator">=</span> <span class="token function">UITableView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> dataSource <span class="token operator">=</span> <span class="token builtin">ArrayTableViewDataSource</span><span class="token operator">&lt;</span><span class="token builtin">Any</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>tableView<span class="token punctuation">,</span> indexPath<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">UITableViewCell</span> <span class="token keyword">in</span>\n\n        <span class="token keyword">if</span> <span class="token keyword">let</span> item <span class="token operator">=</span> item <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">Type1</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string">"Cell1"</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token builtin">CellType1</span>\n\n            cell<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> item<span class="token punctuation">)</span>\n\n            <span class="token keyword">return</span> cell\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">if</span> <span class="token keyword">let</span> item <span class="token operator">=</span> item <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">Type2</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string">"Cell1"</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token builtin">CellType2</span>\n\n            cell<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> item<span class="token punctuation">)</span>\n\n            <span class="token keyword">return</span> cell\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">if</span> <span class="token keyword">let</span> item <span class="token operator">=</span> item <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">Type3</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string">"Cell1"</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token builtin">CellType3</span>\n\n            cell<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> item<span class="token punctuation">)</span>\n\n            <span class="token keyword">return</span> cell\n        <span class="token punctuation">}</span>\n\n        <span class="token function">assertionFailure</span><span class="token punctuation">(</span><span class="token string">"Did not handle item of type"</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token function">UITableViewCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>The down sides of this approach are:</p>\n<ul>\n<li>\n<p>implementation of <code class="language-text">cellFactory</code> grows very fast, and we only have 3 different types of cells.</p>\n</li>\n<li>\n<p>We are using <a href="https://en.wikipedia.org/wiki/Duck_typing">Duck typing</a> to determine which type of cell to display</p>\n</li>\n<li>\n<p>There are no compile time guaranties that we handled all type of items</p>\n</li>\n</ul>\n<h2>Using enum with associated values</h2>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token keyword">enum</span> <span class="token builtin">CellItem</span> <span class="token punctuation">{</span>\n    <span class="token keyword">case</span> <span class="token function">item1</span><span class="token punctuation">(</span><span class="token builtin">Type1</span><span class="token punctuation">)</span>\n    <span class="token keyword">case</span> <span class="token function">item2</span><span class="token punctuation">(</span><span class="token builtin">Type2</span><span class="token punctuation">)</span>\n    <span class="token keyword">case</span> <span class="token function">item3</span><span class="token punctuation">(</span><span class="token builtin">Type3</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">MyViewController</span> <span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">let</span> tableView <span class="token operator">=</span> <span class="token function">UITableView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> dataSource <span class="token operator">=</span> <span class="token builtin">ArrayTableViewDataSource</span><span class="token operator">&lt;</span><span class="token builtin">CellItem</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>tableView<span class="token punctuation">,</span> indexPath<span class="token punctuation">,</span> cellItem<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">UITableViewCell</span> <span class="token keyword">in</span>\n        <span class="token keyword">switch</span> cellItem <span class="token punctuation">{</span>\n        <span class="token keyword">case</span> <span class="token keyword">let</span> <span class="token punctuation">.</span><span class="token function">item1</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string">"Cell1"</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token builtin">CellType1</span>\n\n            cell<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> item<span class="token punctuation">)</span>\n\n            <span class="token keyword">return</span> cell\n        <span class="token keyword">case</span> <span class="token keyword">let</span> <span class="token punctuation">.</span><span class="token function">item2</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string">"Cell1"</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token builtin">CellType2</span>\n\n            cell<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> item<span class="token punctuation">)</span>\n\n            <span class="token keyword">return</span> cell\n        <span class="token keyword">case</span> <span class="token keyword">let</span> <span class="token punctuation">.</span><span class="token function">item3</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string">"Cell1"</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">!</span> <span class="token builtin">CellType3</span>\n\n            cell<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> item<span class="token punctuation">)</span>\n\n            <span class="token keyword">return</span> cell\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Pros:</p>\n<ul>\n<li>\n<p>We have a compile time guaranties that we will handle all types of items</p>\n</li>\n<li>\n<p>We do not use Duck typing</p>\n</li>\n</ul>\n<p>Cons:</p>\n<ul>\n<li>\n<p>Implementation of the <code class="language-text">cellFactory</code> is still quite big.</p>\n</li>\n<li>\n<p>For each screen where we need list with a different type of cells we would need to create a new <code class="language-text">CellItem</code> type.</p>\n</li>\n<li>\n<p>We violate <a href="https://8thlight.com/blog/uncle-bob/2014/05/12/TheOpenClosedPrinciple.html">Open Closed Principle</a> , if we add a new type of cell we would need to modify code in every places where we use it.</p>\n</li>\n</ul>\n<p>Also one of the things that I do not like about both of these approaches is that we need to break encapsulation (make all of the properties public) in order to put data to a cell</p>\n<h2>Can we do better?</h2>\n<div style="text-align:center"><img src="/better-211579ff1cd1fe5c6bc0a6bc35ba9a85.gif"></div>\n<p>Yes we can! What if we treat each different type of item as a <code class="language-text">Component</code> that knows how to <strong>render</strong> itself and in which type of <code class="language-text">UITableViewCell</code> it can be rendered?</p>\n<p>Let‚Äôs think what do we need for it to be rendered in a table view:</p>\n<ul>\n<li>\n<p>We need <code class="language-text">reuseID</code></p>\n</li>\n<li>\n<p>We need ability to register <code class="language-text">Cell</code> type or <code class="language-text">Nib</code> in the <code class="language-text">UITableView</code></p>\n</li>\n<li>\n<p>And we need to have an access to <code class="language-text">UITableViewCell</code> object to populate its views</p>\n</li>\n</ul>\n<p>So minimal interface could look something like this</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift">protocol <span class="token builtin">Component</span> <span class="token punctuation">{</span>\n    associatedtype <span class="token builtin">Cell</span><span class="token punctuation">:</span> <span class="token builtin">UITableViewCell</span>\n\n    <span class="token keyword">var</span> reuseID<span class="token punctuation">:</span> <span class="token builtin">String</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>\n\n    <span class="token keyword">func</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">in</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">)</span>\n    <span class="token keyword">func</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">in</span> cell<span class="token punctuation">:</span> <span class="token builtin">Cell</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">extension</span> <span class="token builtin">Component</span> <span class="token punctuation">{</span>\n  <span class="token comment">// default implementation</span>\n    <span class="token keyword">var</span> reuseID<span class="token punctuation">:</span> <span class="token builtin">String</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>reflecting<span class="token punctuation">:</span> <span class="token builtin">Cell</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>We can go even further and add default implementation for <code class="language-text">register(in:)</code> method for <code class="language-text">NibLoadable</code> cells and cells created manually:</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift">protocol <span class="token builtin">NibLoadable</span> <span class="token punctuation">{</span>\n    <span class="token keyword">static</span> <span class="token keyword">var</span> nib<span class="token punctuation">:</span> <span class="token builtin">UINib</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">extension</span> <span class="token builtin">Component</span> <span class="token punctuation">{</span>\n    <span class="token keyword">func</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">in</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        tableView<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token builtin">Cell</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> forCellReuseIdentifier<span class="token punctuation">:</span> reuseID<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">extension</span> <span class="token builtin">Component</span> <span class="token keyword">where</span> <span class="token builtin">Cell</span><span class="token punctuation">:</span> <span class="token builtin">NibLoadable</span> <span class="token punctuation">{</span>\n    <span class="token keyword">func</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">in</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        tableView<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token builtin">Cell</span><span class="token punctuation">.</span>nib<span class="token punctuation">,</span> forCellReuseIdentifier<span class="token punctuation">:</span> reuseID<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>But doing so we‚Äôll have a serious problem, a <code class="language-text">Component</code> is a protocol with associated type, which means that we can not have an array of components</p>\n<div style="text-align:center"><img src="/huston-c48290e00dcc2331dd67eafac915b818.gif"></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/error-db4e90ee2a8b88804895179c51cb9e97-1f7b6.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 8.15154994259472%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAY0lEQVQI13WJQQ5AMBREex+SooL295ewIA5hqxX3X05UhZ3Fy8y8ESs1WLoWc9dj1hyzxlhJjKr4pyowqfLbbx9kDnH2jMMxvLEI7BAswZN5HOnoKGI/f/fd6PQnn+D0b3mGC4o3Rl3yS0LWAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="error"\n        title=""\n        src="/static/error-db4e90ee2a8b88804895179c51cb9e97-fb8a0.png"\n        srcset="/static/error-db4e90ee2a8b88804895179c51cb9e97-1a291.png 148w,\n/static/error-db4e90ee2a8b88804895179c51cb9e97-2bc4a.png 295w,\n/static/error-db4e90ee2a8b88804895179c51cb9e97-fb8a0.png 590w,\n/static/error-db4e90ee2a8b88804895179c51cb9e97-526de.png 885w,\n/static/error-db4e90ee2a8b88804895179c51cb9e97-fa2eb.png 1180w,\n/static/error-db4e90ee2a8b88804895179c51cb9e97-1f7b6.png 1742w"\n        sizes="(max-width: 590px) 100vw, 590px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>For that we need to ‚Äúerase‚Äù a type:</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">AnyComponent</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">let</span> _register<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token builtin">UITableView</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Void</span>\n    <span class="token keyword">private</span> <span class="token keyword">let</span> _render<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token builtin">UITableViewCell</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Void</span>\n    <span class="token keyword">let</span> reuseID<span class="token punctuation">:</span> <span class="token builtin">String</span>\n\n    <span class="token keyword">init</span><span class="token operator">&lt;</span><span class="token builtin">Base</span><span class="token punctuation">:</span> <span class="token builtin">Component</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">_</span> base<span class="token punctuation">:</span> <span class="token builtin">Base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>reuseID <span class="token operator">=</span> base<span class="token punctuation">.</span>reuseID\n        <span class="token keyword">self</span><span class="token punctuation">.</span>_register <span class="token operator">=</span> base<span class="token punctuation">.</span>register\n        <span class="token keyword">self</span><span class="token punctuation">.</span>_render <span class="token operator">=</span> <span class="token punctuation">{</span> cell <span class="token keyword">in</span>\n            <span class="token keyword">guard</span> <span class="token keyword">let</span> cell <span class="token operator">=</span> cell <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">Base</span><span class="token punctuation">.</span><span class="token builtin">Cell</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n                <span class="token function">assertionFailure</span><span class="token punctuation">(</span><span class="token string">"Type missmatch"</span><span class="token punctuation">)</span>\n                <span class="token keyword">return</span>\n            <span class="token punctuation">}</span>\n            base<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> cell<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">func</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">in</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">_register</span><span class="token punctuation">(</span>tableView<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">func</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">in</span> cell<span class="token punctuation">:</span> <span class="token builtin">UITableViewCell</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">_render</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">extension</span> <span class="token builtin">Component</span> <span class="token punctuation">{</span>\n  <span class="token comment">// To be able to erase the type of component</span>\n    <span class="token keyword">var</span> anyComponent<span class="token punctuation">:</span> <span class="token builtin">AnyComponent</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token function">AnyComponent</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>Now let‚Äôs improve our data source class with <code class="language-text">AnyComponent</code> since we no longer need a <code class="language-text">cellFactory</code>, because our components can now register and render themselves.</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ArrayTableViewDataSource</span><span class="token punctuation">:</span> <span class="token builtin">NSObject</span><span class="token punctuation">,</span> <span class="token builtin">UITableViewDataSource</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">var</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">AnyComponent</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token keyword">private</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token operator">?</span>\n\n    <span class="token keyword">init</span><span class="token punctuation">(</span>items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">AnyComponent</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items\n        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView <span class="token operator">=</span> tableView\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">func</span> <span class="token function">update</span><span class="token punctuation">(</span>with items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">AnyComponent</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>items <span class="token operator">=</span> items\n        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">reloadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> numberOfRowsInSection section<span class="token punctuation">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Int</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token builtin">count</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> cellForRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">UITableViewCell</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> item <span class="token operator">=</span> items<span class="token punctuation">[</span>indexPath<span class="token punctuation">.</span>row<span class="token punctuation">]</span>\n        <span class="token keyword">guard</span> <span class="token keyword">let</span> cell <span class="token operator">=</span> tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> item<span class="token punctuation">.</span>reuseID<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            item<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> tableView<span class="token punctuation">)</span>\n\n            <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">tableView</span><span class="token punctuation">(</span>tableView<span class="token punctuation">,</span> cellForRowAt<span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n\n        item<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> cell<span class="token punctuation">)</span>\n\n        <span class="token keyword">return</span> cell\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>And using it like this:</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>\n\n    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> dataSource <span class="token operator">=</span> <span class="token builtin">ArrayTableViewDataSource</span><span class="token operator">&lt;</span><span class="token builtin">AnyComponent</span><span class="token operator">></span><span class="token punctuation">(</span>tableView<span class="token punctuation">:</span> tableView<span class="token punctuation">)</span>\n\n    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function">showData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        dataSource<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n            <span class="token function">Title</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string">"Tittle"</span><span class="token punctuation">)</span>\n                <span class="token punctuation">.</span>anyComponent<span class="token punctuation">,</span> <span class="token comment">// This is not cool bro üòÖ</span>\n            <span class="token function">TitleDetails</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string">"Tittle"</span><span class="token punctuation">,</span> details<span class="token punctuation">:</span> <span class="token string">"Details"</span><span class="token punctuation">)</span>\n                <span class="token punctuation">.</span>anyComponent\n            <span class="token punctuation">]</span>\n        <span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<h2>Custom operators</h2>\n<p>As you may notice transforming concrete type of the <code class="language-text">Component</code> to <code class="language-text">AnyComponent</code> is quite annoying but we can improve it by using custom operators</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift">precedencegroup <span class="token builtin">ComponentConcatenationPrecedence</span> <span class="token punctuation">{</span>\n    <span class="token keyword">associativity</span><span class="token punctuation">:</span> <span class="token keyword">left</span>\n    higherThan<span class="token punctuation">:</span> <span class="token builtin">AdditionPrecedence</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">infix</span> <span class="token keyword">operator</span> <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">+</span><span class="token punctuation">:</span> <span class="token builtin">ComponentConcatenationPrecedence</span>\n\n<span class="token keyword">public</span> <span class="token keyword">struct</span> <span class="token builtin">Form</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> components<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">AnyComponent</span><span class="token punctuation">]</span>\n\n    <span class="token keyword">static</span> <span class="token keyword">var</span> empty<span class="token punctuation">:</span> <span class="token builtin">Form</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token function">Form</span><span class="token punctuation">(</span>components<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token operator">&lt;</span>C<span class="token punctuation">:</span> <span class="token builtin">Component</span><span class="token operator">></span><span class="token punctuation">(</span>form<span class="token punctuation">:</span> <span class="token builtin">Form</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> C<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Form</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token function">Form</span><span class="token punctuation">(</span>components<span class="token punctuation">:</span> form<span class="token punctuation">.</span>components <span class="token operator">+</span> <span class="token punctuation">[</span>component<span class="token punctuation">.</span>anyComponent<span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>And using it like this</p>\n<div class="gatsby-highlight">\n      <pre class="language-swift"><code class="language-swift"><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">let</span> tableView <span class="token operator">=</span> <span class="token function">UITableView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">private</span> <span class="token keyword">lazy</span> <span class="token keyword">var</span> dataSource <span class="token operator">=</span> <span class="token function">ArrayTableViewDataSource</span><span class="token punctuation">(</span>tableView<span class="token punctuation">:</span> tableView<span class="token punctuation">)</span>\n\n    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function">showData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> form <span class="token operator">=</span> <span class="token punctuation">[</span>\n            <span class="token string">"Hello World!"</span><span class="token punctuation">,</span>\n            <span class="token string">"Ol√° Mundo!"</span><span class="token punctuation">,</span>\n            <span class="token string">"Bonjour le monde"</span><span class="token punctuation">,</span>\n            <span class="token string">"Hola Mundo"</span><span class="token punctuation">,</span>\n            <span class="token string">"Hallo Welt"</span>\n        <span class="token punctuation">]</span>\n        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token builtin">Form</span><span class="token punctuation">.</span>empty<span class="token punctuation">)</span> <span class="token punctuation">{</span> $<span class="token number">0</span> <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">+</span> <span class="token function">Title</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> $<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n\n        dataSource<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<h2>Conclusion</h2>\n<ul>\n<li>\n<p>Our <code class="language-text">ArrayTableViewDataSource</code> is self sufficient class e.g we do not need <code class="language-text">cellFactory</code> anymore.</p>\n</li>\n<li>\n<p><code class="language-text">Component</code> implementation ensures that we render cell correctly</p>\n</li>\n<li>\n<p>We do not break <code class="language-text">Open Closed</code> principle, in order to add a new type of cell we just need to implement new <code class="language-text">Component</code></p>\n</li>\n<li>\n<p>We can design our interfaces based on components, styling them differently. Which will enable a lot of code reuse.</p>\n</li>\n</ul>\n<h1>P.S.</h1>\n<p>This is actually one of the approaches we used to design <a href="https://github.com/Babylonpartners/Bento">Bento üç±</a></p>',
frontmatter:{title:"Component Based UITableView",date:"August 08, 2018"}}},pathContext:{slug:"/component-based-tv/",previous:{fields:{slug:"/implement-rx/"},frontmatter:{title:"Learn Rx by implementing Observable"}},next:{fields:{slug:"/object-composition/"},frontmatter:{title:"Power of Composition"}}}}}});
//# sourceMappingURL=path---component-based-tv-d39a9455ce80d6e2b56d.js.map