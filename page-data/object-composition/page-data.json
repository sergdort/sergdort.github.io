{"componentChunkName":"component---src-templates-blog-post-js","path":"/object-composition/","result":{"data":{"site":{"siteMetadata":{"title":"Journey before destination, tests before production"}},"markdownRemark":{"id":"af2172ba-19d4-5f09-b72e-f078e67379d3","excerpt":"Object composition is fundamental to OOP—and for good reason. Real-world systems are built from smaller parts, and software models this naturally through…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d6b78f2106cc8cd9d5676d243516a66b/d165a/space_station.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGOWMKCP//EABsQAQACAgMAAAAAAAAAAAAAAAIAAQMREiEx/9oACAEBAAEFAgycaV8Jn8XS3c//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhAhIxMkH/2gAIAQEABj8Cc2a3XqOrYjKDk//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESFBMWFRcZH/2gAIAQEAAT8hUEDfuNJKcshK890ZiOom0rOp3vs//9oADAMBAAIAAwAAABB3/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxBZ/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QSf/EABwQAQADAAIDAAAAAAAAAAAAAAEAESExYYGRsf/aAAgBAQABPxAQttDlL6cTY30eD2QaGBwxE9TJYksOHJaJ2qlQUflP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"space station\"\n        title=\"\"\n        src=\"/static/d6b78f2106cc8cd9d5676d243516a66b/1c72d/space_station.jpg\"\n        srcset=\"/static/d6b78f2106cc8cd9d5676d243516a66b/a80bd/space_station.jpg 148w,\n/static/d6b78f2106cc8cd9d5676d243516a66b/1c91a/space_station.jpg 295w,\n/static/d6b78f2106cc8cd9d5676d243516a66b/1c72d/space_station.jpg 590w,\n/static/d6b78f2106cc8cd9d5676d243516a66b/a8a14/space_station.jpg 885w,\n/static/d6b78f2106cc8cd9d5676d243516a66b/fbd2c/space_station.jpg 1180w,\n/static/d6b78f2106cc8cd9d5676d243516a66b/d165a/space_station.jpg 1400w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"https://en.wikipedia.org/wiki/Object_composition\">Object composition</a> is fundamental to OOP—and for good reason. Real-world systems are built from smaller parts, and software models this naturally through composition.</p>\n<p>This article won’t argue <a href=\"https://en.wikipedia.org/wiki/Composition_over_inheritance\">why composition beats inheritance</a>. Instead, I want to show an example where composition really shines.</p>\n<h2>Building requests through composition</h2>\n<p>Consider an interface for producing <code class=\"language-text\">URLRequest</code> objects:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">URLRequest</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A basic implementation:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">RequestWithURL</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> url<span class=\"token punctuation\">:</span> <span class=\"token constant\">URL</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">:</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>url <span class=\"token operator\">=</span> url\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">URLRequest</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">URLRequest</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">:</span> url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, a <code class=\"language-text\">POST</code> request:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">POSTRequest</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>base <span class=\"token operator\">=</span> base\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">URLRequest</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> request <span class=\"token operator\">=</span> base<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        request<span class=\"token punctuation\">.</span>httpMethod <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"POST\"</span></span>\n        <span class=\"token keyword\">return</span> request\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Notice the pattern: <code class=\"language-text\">POSTRequest</code> wraps another <code class=\"language-text\">Request</code> and adds behavior. It doesn’t care what kind of request it wraps.</p>\n<p>A Bearer authentication header:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">BearerRequest</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> token<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>base <span class=\"token operator\">=</span> base\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>token <span class=\"token operator\">=</span> token\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">URLRequest</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> request <span class=\"token operator\">=</span> base<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        request<span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Bearer </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">token</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">,</span> forHTTPHeaderField<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Authorization\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> request\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The power here: small, focused types that compose into complex behavior.</p>\n<h2>Composing requests</h2>\n<p>Let’s build an authenticated POST request with a body. First, a body wrapper:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">RequestWithBody</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> data<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Data</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Data</span><span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>data <span class=\"token operator\">=</span> data\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>base <span class=\"token operator\">=</span> base\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">URLRequest</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> request <span class=\"token operator\">=</span> base<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        request<span class=\"token punctuation\">.</span>httpBody <span class=\"token operator\">=</span> data\n        <span class=\"token keyword\">return</span> request\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now compose them:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> request <span class=\"token operator\">=</span> <span class=\"token class-name\">BearerRequest</span><span class=\"token punctuation\">(</span>\n    token<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"SuperSecretToken\"</span></span><span class=\"token punctuation\">,</span>\n    base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">RequestWithBody</span><span class=\"token punctuation\">(</span>\n        data<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Data</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Hello World\"</span></span><span class=\"token punctuation\">.</span>utf8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">POSTRequest</span><span class=\"token punctuation\">(</span>\n            base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">RequestWithURL</span><span class=\"token punctuation\">(</span>\n                url<span class=\"token punctuation\">:</span> <span class=\"token function\">URL</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"http://example.com\"</span></span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Verbose? Perhaps. But also declarative—each type name describes exactly what it does. You can read the composition and understand the request being built.</p>\n<p>The real advantage is maintainability. Each <code class=\"language-text\">Request</code> type:</p>\n<ul>\n<li>Does one thing</li>\n<li>Is easy to test in isolation</li>\n<li>Can be reused in any combination</li>\n</ul>\n<h2>Fluent interface with view modifier style</h2>\n<p>The nested initializers are readable but awkward. SwiftUI popularized a better pattern: view modifiers. We can apply the same idea here.</p>\n<p>Add methods to the <code class=\"language-text\">Request</code> protocol that return wrapped requests:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">POSTRequest</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">body</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> data<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RequestWithBody</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">bearer</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">Request</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">BearerRequest</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> token<span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now the same composition reads naturally:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> request <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestWithURL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">:</span> <span class=\"token function\">URL</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"http://example.com\"</span></span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Data</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Hello World\"</span></span><span class=\"token punctuation\">.</span>utf8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">bearer</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"SuperSecretToken\"</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This is the builder pattern meets composition. Each modifier:</p>\n<ul>\n<li>Returns a new <code class=\"language-text\">Request</code> wrapping the previous one</li>\n<li>Preserves immutability</li>\n<li>Chains naturally left-to-right</li>\n</ul>\n<p>The underlying types haven’t changed—we just added ergonomic sugar on top. The composition is identical, but the call site is dramatically cleaner.</p>\n<h2>Libraries built on composition</h2>\n<ul>\n<li><strong><a href=\"https://developer.apple.com/xcode/swiftui/\">SwiftUI</a></strong>: The entire framework is composition. Views wrap other views, modifiers wrap views and return new views. A <code class=\"language-text\">Text(\"Hello\").padding().background(Color.red)</code> chain creates a tree of composed view types—each modifier is a struct wrapping the previous one.</li>\n<li><strong><a href=\"https://github.com/ReactiveX/RxSwift\">RxSwift</a></strong>: The public API is FRP, but internally each <a href=\"https://github.com/ReactiveX/RxSwift/blob/master/RxSwift/Observables/Filter.swift#L21\">operator</a> is a new <code class=\"language-text\">Observable</code> type that wraps the source and adds behavior.</li>\n<li><strong><a href=\"https://github.com/facebook/react\">React</a></strong> and <strong><a href=\"https://github.com/flutter/flutter\">Flutter</a></strong>: These take composition to the next level—small, reusable components compose into sophisticated UIs.</li>\n</ul>","frontmatter":{"title":"The Power of Composition","date":"September 01, 2018","tags":["Swift","architecture","design-patterns"]}},"previous":{"fields":{"slug":"/custom-environment-swift-ui/"},"frontmatter":{"title":"Custom @Environment Keys in SwiftUI"}},"next":{"fields":{"slug":"/component-based-tv/"},"frontmatter":{"title":"Component-Based UITableView"}}},"pageContext":{"id":"af2172ba-19d4-5f09-b72e-f078e67379d3","slug":"/object-composition/","previousPostId":"a2ca0b0d-d121-5db6-82da-b14235194fc9","nextPostId":"c832c5af-5047-59d3-9b57-95940de139b6"}},"staticQueryHashes":["63159454"],"slicesMap":{}}