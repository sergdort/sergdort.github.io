{"componentChunkName":"component---src-templates-blog-post-js","path":"/component-based-tv/","result":{"data":{"site":{"siteMetadata":{"title":"iOS Developer in search for meaning üßò‚Äç‚ôÇÔ∏è"}},"markdownRemark":{"id":"c832c5af-5047-59d3-9b57-95940de139b6","excerpt":"and  are workhorses of iOS development, but they demand significant boilerplate. That boilerplate often ends up in view controllers, bloating them unnecessarily‚Ä¶","html":"<p><code class=\"language-text\">UITableView</code> and <code class=\"language-text\">UICollectionView</code> are workhorses of iOS development, but they demand significant boilerplate. That boilerplate often ends up in view controllers, bloating them unnecessarily.</p>\n<p>A common solution is extracting <code class=\"language-text\">UITableViewDataSource</code> into a dedicated class:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ArrayTableViewDataSource</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSObject</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UITableViewDataSource</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token operator\">?</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> cellFactory<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IndexPath</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UITableViewCell</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">,</span> cellFactory<span class=\"token punctuation\">:</span> <span class=\"token attribute atrule\">@escaping</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IndexPath</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UITableViewCell</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView <span class=\"token operator\">=</span> tableView\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>cellFactory <span class=\"token operator\">=</span> cellFactory\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">update</span><span class=\"token punctuation\">(</span>with items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items <span class=\"token operator\">=</span> items\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">,</span> numberOfRowsInSection section<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Int</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> items<span class=\"token punctuation\">.</span>count\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">,</span> cellForRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token class-name\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UITableViewCell</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">cellFactory</span><span class=\"token punctuation\">(</span>tableView<span class=\"token punctuation\">,</span> indexPath<span class=\"token punctuation\">,</span> items<span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> dataSource <span class=\"token operator\">=</span> <span class=\"token class-name\">ArrayTableViewDataSource</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Item</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> tableView<span class=\"token punctuation\">,</span> indexPath<span class=\"token punctuation\">,</span> item <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Cell\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span>\n        cell<span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> cell\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is cleaner‚Äîthe data source is testable and reusable. Just provide a <code class=\"language-text\">cellFactory</code> closure to dequeue and configure cells.</p>\n<p>But what happens when you need multiple cell types?</p>\n<h2>The problem: heterogeneous cells</h2>\n<p>Say you have three data types, each requiring a different cell:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Type1</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CellType1</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableViewCell</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Type1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Type2</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n    <span class=\"token keyword\">let</span> detail<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CellType2</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableViewCell</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Type2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Type3</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> title<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n    <span class=\"token keyword\">let</span> detail<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n    <span class=\"token keyword\">let</span> subtitle<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CellType3</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableViewCell</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Type3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Approach 1: Using <code class=\"language-text\">Any</code></h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> tableView <span class=\"token operator\">=</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> dataSource <span class=\"token operator\">=</span> <span class=\"token class-name\">ArrayTableViewDataSource</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">Any</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> tableView<span class=\"token punctuation\">,</span> indexPath<span class=\"token punctuation\">,</span> item <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> item <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">Type1</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Cell1\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CellType1</span>\n            cell<span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> cell\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> item <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">Type2</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Cell2\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CellType2</span>\n            cell<span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> cell\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> item <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">Type3</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Cell3\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CellType3</span>\n            cell<span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> cell\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">assertionFailure</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Did not handle item of type </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\"><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>of<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span></span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">UITableViewCell</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Problems:</p>\n<ul>\n<li>The <code class=\"language-text\">cellFactory</code> grows linearly with cell types</li>\n<li>Relies on <a href=\"https://en.wikipedia.org/wiki/Duck_typing\">duck typing</a> for dispatch</li>\n<li>No compile-time guarantee that all types are handled</li>\n</ul>\n<h3>Approach 2: Enum with associated values</h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">enum</span> <span class=\"token class-name\">CellItem</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token function\">item1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Type1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">case</span> <span class=\"token function\">item2</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Type2</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">case</span> <span class=\"token function\">item3</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Type3</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> tableView <span class=\"token operator\">=</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> dataSource <span class=\"token operator\">=</span> <span class=\"token class-name\">ArrayTableViewDataSource</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">CellItem</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> tableView<span class=\"token punctuation\">,</span> indexPath<span class=\"token punctuation\">,</span> cellItem <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">switch</span> cellItem <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token keyword\">let</span> <span class=\"token punctuation\">.</span><span class=\"token function\">item1</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Cell1\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CellType1</span>\n            cell<span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> cell\n        <span class=\"token keyword\">case</span> <span class=\"token keyword\">let</span> <span class=\"token punctuation\">.</span><span class=\"token function\">item2</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Cell2\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CellType2</span>\n            cell<span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> cell\n        <span class=\"token keyword\">case</span> <span class=\"token keyword\">let</span> <span class=\"token punctuation\">.</span><span class=\"token function\">item3</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Cell3\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token class-name\">CellType3</span>\n            cell<span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> cell\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Better‚Äîwe get exhaustiveness checking. But:</p>\n<ul>\n<li>The <code class=\"language-text\">cellFactory</code> is still bloated</li>\n<li>Every screen with different cell combinations needs its own enum</li>\n<li>Violates the <a href=\"https://8thlight.com/blog/uncle-bob/2014/05/12/TheOpenClosedPrinciple.html\">Open-Closed Principle</a>: adding a cell type means modifying every usage site</li>\n</ul>\n<p>Both approaches also force you to expose cell internals publicly just to populate them.</p>\n<h2>A better approach: self-rendering components</h2>\n<div style=\"text-align:center\"><img src=\"/211579ff1cd1fe5c6bc0a6bc35ba9a85/better.gif\"></div>\n<p>What if each item knew how to render itself and which cell type it belongs to?</p>\n<p>A component needs:</p>\n<ul>\n<li>A reuse identifier</li>\n<li>The ability to register its cell type</li>\n<li>Access to the cell instance for rendering</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">associatedtype</span> <span class=\"token class-name\">Cell</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableViewCell</span>\n\n    <span class=\"token keyword\">var</span> reuseID<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">register</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> cell<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Cell</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> reuseID<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>reflecting<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Cell</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We can provide default <code class=\"language-text\">register(in:)</code> implementations for programmatic and nib-based cells:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">NibLoadable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">var</span> nib<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UINib</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">register</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        tableView<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Cell</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span> forCellReuseIdentifier<span class=\"token punctuation\">:</span> reuseID<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">Component</span> <span class=\"token keyword\">where</span> <span class=\"token class-name\">Cell</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">NibLoadable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">register</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        tableView<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Cell</span><span class=\"token punctuation\">.</span>nib<span class=\"token punctuation\">,</span> forCellReuseIdentifier<span class=\"token punctuation\">:</span> reuseID<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>The PAT problem</h3>\n<div style=\"text-align:center\"><img src=\"/c48290e00dcc2331dd67eafac915b818/huston.gif\"></div>\n<p><code class=\"language-text\">Component</code> has an associated type, so we can‚Äôt create <code class=\"language-text\">[Component]</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db4e90ee2a8b88804895179c51cb9e97/76435/error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.108108108108107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAZUlEQVR42lXLSw5AQBAEUBeSIQh6PhKfBAs3sGNw/wOUGmFh8VJVnXS0uApTXVCDkWYp0WfJz5Cn6IOwn3w3dd+N2iRGdDUWp7PwmqyDNwa70exMrUlwsIe9ifzy4N9u5MlgVQo3r8tGnhTAphUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"error\"\n        title=\"\"\n        src=\"/static/db4e90ee2a8b88804895179c51cb9e97/fcda8/error.png\"\n        srcset=\"/static/db4e90ee2a8b88804895179c51cb9e97/12f09/error.png 148w,\n/static/db4e90ee2a8b88804895179c51cb9e97/e4a3f/error.png 295w,\n/static/db4e90ee2a8b88804895179c51cb9e97/fcda8/error.png 590w,\n/static/db4e90ee2a8b88804895179c51cb9e97/efc66/error.png 885w,\n/static/db4e90ee2a8b88804895179c51cb9e97/c83ae/error.png 1180w,\n/static/db4e90ee2a8b88804895179c51cb9e97/76435/error.png 1742w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The solution: type erasure.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AnyComponent</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> _register<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> _render<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UITableViewCell</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Void</span>\n    <span class=\"token keyword\">let</span> reuseID<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Base</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Component</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> base<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Base</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>reuseID <span class=\"token operator\">=</span> base<span class=\"token punctuation\">.</span>reuseID\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>_register <span class=\"token operator\">=</span> base<span class=\"token punctuation\">.</span>register\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>_render <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> cell <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> cell <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">Base</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">Cell</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">assertionFailure</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Type mismatch\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">return</span>\n            <span class=\"token punctuation\">}</span>\n            base<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> cell<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">register</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">_register</span><span class=\"token punctuation\">(</span>tableView<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> cell<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableViewCell</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">_render</span><span class=\"token punctuation\">(</span>cell<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> anyComponent<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AnyComponent</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">AnyComponent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now the data source simplifies‚Äîno more <code class=\"language-text\">cellFactory</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ArrayTableViewDataSource</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">NSObject</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UITableViewDataSource</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">AnyComponent</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">weak</span> <span class=\"token keyword\">var</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token operator\">?</span>\n\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">AnyComponent</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items <span class=\"token operator\">=</span> items\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView <span class=\"token operator\">=</span> tableView\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">update</span><span class=\"token punctuation\">(</span>with items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">AnyComponent</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items <span class=\"token operator\">=</span> items\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">,</span> numberOfRowsInSection section<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Int</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> items<span class=\"token punctuation\">.</span>count\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">,</span> cellForRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token class-name\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">UITableViewCell</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> items<span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">.</span>reuseID<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            item<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> tableView<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span>tableView<span class=\"token punctuation\">,</span> cellForRowAt<span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        item<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> cell<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> cell\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Usage:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> dataSource <span class=\"token operator\">=</span> <span class=\"token class-name\">ArrayTableViewDataSource</span><span class=\"token punctuation\">(</span>tableView<span class=\"token punctuation\">:</span> tableView<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">showData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        dataSource<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token class-name\">Title</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Title\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>anyComponent<span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">TitleDetails</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Title\"</span></span><span class=\"token punctuation\">,</span> details<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Details\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>anyComponent\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Cleaner syntax with custom operators</h3>\n<p>The <code class=\"language-text\">.anyComponent</code> calls are noisy. A custom operator can help:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">precedencegroup</span> <span class=\"token class-name\">ComponentConcatenationPrecedence</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">associativity</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">left</span>\n    <span class=\"token keyword\">higherThan</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">AdditionPrecedence</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">infix</span> <span class=\"token keyword\">operator</span> <span class=\"token operator\">|-+</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">ComponentConcatenationPrecedence</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">Form</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> components<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">AnyComponent</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">var</span> empty<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Form</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Form</span><span class=\"token punctuation\">(</span>components<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">func</span> <span class=\"token operator\">|-+</span> <span class=\"token operator\">&lt;</span><span class=\"token class-name\">C</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Component</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Form</span><span class=\"token punctuation\">,</span> component<span class=\"token punctuation\">:</span> <span class=\"token class-name\">C</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Form</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Form</span><span class=\"token punctuation\">(</span>components<span class=\"token punctuation\">:</span> form<span class=\"token punctuation\">.</span>components <span class=\"token operator\">+</span> <span class=\"token punctuation\">[</span>component<span class=\"token punctuation\">.</span>anyComponent<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ViewController</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> tableView <span class=\"token operator\">=</span> <span class=\"token class-name\">UITableView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">lazy</span> <span class=\"token keyword\">var</span> dataSource <span class=\"token operator\">=</span> <span class=\"token class-name\">ArrayTableViewDataSource</span><span class=\"token punctuation\">(</span>tableView<span class=\"token punctuation\">:</span> tableView<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">showData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> form <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string-literal\"><span class=\"token string\">\"Hello World!\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal\"><span class=\"token string\">\"Ol√° Mundo!\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal\"><span class=\"token string\">\"Bonjour le monde\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal\"><span class=\"token string\">\"Hola Mundo\"</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-literal\"><span class=\"token string\">\"Hallo Welt\"</span></span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Form</span><span class=\"token punctuation\">.</span>empty<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token short-argument\">$0</span> <span class=\"token operator\">|-+</span> <span class=\"token class-name\">Title</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token short-argument\">$1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n        dataSource<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Conclusion</h2>\n<ul>\n<li><code class=\"language-text\">ArrayTableViewDataSource</code> becomes self-sufficient‚Äîno external configuration needed</li>\n<li>Each <code class=\"language-text\">Component</code> encapsulates its own rendering logic</li>\n<li>Adding new cell types means adding new components‚Äîno existing code changes required (Open-Closed Principle)</li>\n<li>Components enable consistent, reusable UI building blocks across your app</li>\n</ul>\n<h2>P.S.</h2>\n<p>This pattern evolved into <a href=\"https://github.com/Babylonpartners/Bento\">Bento</a>, which we built at Babylon Health.</p>","frontmatter":{"title":"Component-Based UITableView","date":"August 08, 2018"}},"previous":{"fields":{"slug":"/object-composition/"},"frontmatter":{"title":"The Power of Composition"}},"next":{"fields":{"slug":"/implement-rx/"},"frontmatter":{"title":"Learn Rx by Implementing Observable"}}},"pageContext":{"id":"c832c5af-5047-59d3-9b57-95940de139b6","slug":"/component-based-tv/","previousPostId":"af2172ba-19d4-5f09-b72e-f078e67379d3","nextPostId":"7740deba-788a-5166-9192-a8e78d256b62"}},"staticQueryHashes":["63159454"],"slicesMap":{}}